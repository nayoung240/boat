<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="materialize/css/materialize.min.css"  media="screen,projection"/>
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bj</title>
</head>
<style>
    .loader {
        width: 40px;
        height: 40px;
        display: block;
        margin: 40px auto;
        position: relative;
        border: 3px solid #60c6bd;
        border-radius: 50%;
        box-sizing: border-box;
        animation: animloader 2s linear infinite;   
    }
    .loader::after {
        content: '';  
        box-sizing: border-box;
        width: 6px;
        height: 24px;
        background: #60c6bd;
        transform: rotate(-45deg);
        position: absolute;
        bottom: -20px;
        left: 40px;
    }

    @keyframes animloader {
        0% {
            transform: translate(-10px, -10px);
        }
        25% {
            transform: translate(-10px, 10px);
        }
        50% {
            transform: translate(10px, 10px);
        }
        75% {
            transform: translate(10px, -10px);
        }
        100% {
            transform: translate(-10px, -10px);
        }
    }

    .add-time {
        border-radius: 20px;
    }
</style>
<body style="width: 500px;height: 640px;padding: 10px;">
    <div class="container">
        <span class="loader"></span>
        <p style="text-align: center;"><b><span id="bjnick"></span>님! 몇분동안 민심을 파악하실건가요?</b></p>
        <form id="candidate-form">
            <div style="text-align: center;">
                <a data-time="1" class="add-time waves-effect waves-light btn-small cyan darken-1">+1분</a>
                <a data-time="5" class="add-time waves-effect waves-light btn-small cyan darken-1">+5분</a>
                <a data-time="10" class="add-time waves-effect waves-light btn-small cyan darken-1">+10분</a>
                <a data-time="30" class="add-time waves-effect waves-light btn-small cyan darken-1">+30분</a>
            </div>
            <div class="input-field" style="text-align: center;">
                <input type="number" id="timer" min="1" max="86400" style="width: 100px; text-align: center;">분<span id="trans-time" style="margin-left: 10px;color: darkturquoise;"></span>
                <button class="btn-large btn-floating waves-effect waves-light cyan darken-4" type="submit">Start!</button>
            </div><br>
            <div style="text-align: center;">
            </div>
        </form>
    </div>
    <!--JavaScript at end of body for optimized loading-->
    <script type="text/javascript" src="https://static.afreecatv.com/asset/app/extension-helper/afreecatv-extension-sdk.js"></script>
    <script type="text/javascript" src="materialize/js/materialize.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize Materialize form components
            M.AutoInit();

            const SDK = window.AFREECA.ext;
            const extensionSdk = SDK();

            let isLoggedIn = false;
            let isBJ = false;
            let broadInfo = null; // 방송 정보
            let playerInfo = null; // 플레이어 상태 정보

            const init =(auth, broad, player)=>{
                isLoggedIn = !!auth.obscureUserId;
                isBJ = auth.isBJ;

                broadInfo = broad;
                playerInfo = player;

                document.getElementById('bjnick').innerText = broadInfo.bjNickname;
            
                renderError("로그인을 해주세요.");
            }

            extensionSdk.handleInitialization(init);

 

            // Handle form submission
            document.getElementById('candidate-form').addEventListener('submit', function (event) {
                event.preventDefault();
                const timer = document.querySelector("#timer");
                console.log(timer.value)
            });

            document.getElementById('timer').addEventListener("change", function(e) {
                this.value = this.value.replace(/[^0-9]/g,'');
                const inputTime = e.target.value;

                console.log('타이머 추가')
                if (inputTime > 60) {
                    let transSpan = document.getElementById('trans-time');

                    const h = Math.floor(inputTime / 60);
                    const m = inputTime % 60;

                    // 시와 분을 문자열로 표시
                    const transTime = `${h}시간 ${m}분`;
                    transSpan.innerText = transTime;
                }
                else if (inputTime > 1400) {
                    alert('1일 이상 타이머 지정이 불가합니다.');
                    this.value = 1400;
                }
            });

            let addTimeElAll = document.querySelectorAll('.add-time');
            addTimeElAll.forEach((target) => target.addEventListener("click", function(e){ 
                    const addTime = target.dataset.time;
                    const timerEl = document.getElementById('timer');

                    timerEl.value = Number(timerEl.value) + Number(addTime);

                    // change event trigger
                    document.getElementById('timer').dispatchEvent(new Event('change'));
                })
            );
        });
    </script>
</body>
</html>